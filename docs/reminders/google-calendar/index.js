(()=>{"use strict";const t=JSON.parse('{"Rm":"AIzaSyCIVwy-EeQTsEF8GrxfACvBVDAcsQwE3aI","cS":["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],"Ro":"392633700892-bham3toa4uf309t8jit739t8ut4t9pc9.apps.googleusercontent.com","k0":["https://www.googleapis.com/auth/calendar"]}'),e=new Promise((function(e){gapi.load("client",(async function(){await gapi.client.init({apiKey:t.Rm,discoveryDocs:t.cS}),e()}))}));let n;const i=google.accounts.oauth2.initTokenClient({client_id:t.Ro,scope:t.k0.join(" "),callback:t=>n(t)});function r(t){document.querySelectorAll("#message div").forEach((function(t){t.setAttribute("hidden","")})),document.getElementById(t).removeAttribute("hidden")}const s=JSON.parse('{"storage-keys":{"assignments-data":""},"calendar-name":"manabaの課題"}'),a=[s];for(;a.length>0;){const t=a.pop();for(const e in t){const n=t[e];"string"==typeof n?""===n&&(t[e]=e):a.push(n)}}const o=s,c=new TextEncoder;class l{constructor(t,e,n,i=null){this.url=t,this.title=e,this.course=n,this.deadline=i,this._isShown=!0,this.onIsShownChanged=[],this.hash=async function(t){const e=c.encode(t),n=await crypto.subtle.digest("SHA-256",e),i=new Uint8Array(n);return Array.from(i).map((t=>t.toString(16).padStart(2,"0"))).join("")}(t)}toString(){return JSON.stringify({url:this.url,title:this.title,course:this.course,deadline:this.deadline?.getTime()??0})}static from(t){const e=JSON.parse(t);let n=null;return e.deadline>0&&(n=new Date(e.deadline)),new l(e.url,e.title,e.course,n)}get isShown(){return this._isShown}set isShown(t){if(this._isShown!==t){this._isShown=t;for(const e of this.onIsShownChanged)e(t)}}}let u=null;document.querySelector("#register button")?.addEventListener("click",(async function(t){if(await async function(){if(null===u){await e;const t=await async function(){return new Promise((function(t){n=t,null===gapi.client.getToken()?i.requestAccessToken({prompt:"consent"}):i.requestAccessToken({prompt:""})}))}();if("error"in t){const e=[t.error,t.error_description,t.error_uri].join("\n");return alert(e),!0}if(r("initializing"),u=await async function(){const t=(await gapi.client.calendar.calendarList.list()).result.items;if(void 0!==t)for(const e of t)if(e.summary===o["calendar-name"])return void 0===e.id?null:e.id;return null}(),null===u)return u=await async function(){const t=Intl.DateTimeFormat().resolvedOptions().timeZone,e=(await gapi.client.calendar.calendars.insert({},{summary:o["calendar-name"],timeZone:t})).result.id;return void 0===e?null:e}(),r(null===u?"initialization-failed":"created"),!0;r("initialized")}return!1}())return;const s=t.target.getAttribute("assignments");if(null===s)return;var a;r("registering");const c=(a=s,JSON.parse(a).map((t=>l.from(t)))).map((async function(t){const e=await async function(t){if(null===u)return null;if(null===t.deadline)return null;const e=`${t.title} | ${t.course}`,n=t.url,i=t.deadline,r=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours()-1),s=Intl.DateTimeFormat().resolvedOptions().timeZone;try{return(await gapi.client.calendar.events.insert({calendarId:u,resource:{summary:e,description:n,start:{dateTime:r.toISOString(),timeZone:s},end:{dateTime:i.toISOString(),timeZone:s}}})).result}catch(t){console.error(t)}return null}(t);return{assignment:t,event:e}})),d=await Promise.all(c),m=[];for(const{assignment:t,event:e}of d)null!==e&&m.push(t);const g=(h=m,JSON.stringify(h.map((t=>t.toString())))),f=document.querySelector("#register .callback");var h;f.setAttribute("assignments",g),f.dispatchEvent(new Event("click")),r("registered")}))})();